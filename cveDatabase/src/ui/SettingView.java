package ui;

import java.awt.Button;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPasswordField;
import javax.swing.JScrollPane;
import javax.swing.JSeparator;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.UIManager;

import dataModels.DatabaseConnectionObject;
import services.ServiceLayer;

/**
 * not completed yet
 * 
 * @author Mr Bahram
 *
 */
public class SettingView extends JPanel implements ActionListener {

	ServiceLayer service = new ServiceLayer();
	DatabaseConnectionObject connectionObject = new DatabaseConnectionObject();

	private Button save, test;
	private JTextArea output;
	private JTextField hostAddress, port, userName;
	private JPasswordField password;
	Font font = new Font("Arial", Font.PLAIN, 20);

	public SettingView() {
		setLayout(null);
		setPreferredSize(new Dimension(800, 600));
		// --------------------Host address

		JLabel hostAddressText = new JLabel("Host address ");
		hostAddressText.setBounds(50, 20, 150, 35);
		hostAddressText.setFont(font);
		add(hostAddressText);
		hostAddress = new JTextField("localhost");
		hostAddress.setBounds(210, 20, 200, 35);
		hostAddress.setFont(font);
		add(hostAddress);
		// --------------------Host port
		JLabel portText = new JLabel("Port ");
		portText.setBounds(450, 20, 50, 35);
		portText.setFont(font);
		add(portText);
		port = new JTextField("3306");
		port.setBounds(510, 20, 100, 35);
		port.setFont(font);
		add(port);
		// --------------------Username

		JLabel userNameText = new JLabel("User Name ");
		userNameText.setBounds(50, 70, 150, 35);
		userNameText.setFont(font);
		add(userNameText);
		userName = new JTextField();
		userName.setBounds(210, 70, 200, 35);
		userName.setFont(font);
		add(userName);
		// --------------------Password
		JLabel passwordText = new JLabel("Password ");
		passwordText.setBounds(50, 120, 150, 35);
		passwordText.setFont(font);
		add(passwordText);
		password = new JPasswordField();
		password.setBounds(210, 120, 200, 35);
		password.setFont(font);
		add(password);
		// --------------------Sepration
		JSeparator separator = new JSeparator(SwingConstants.HORIZONTAL);
		separator.setBounds(50, 170, 610, 30);
		add(separator);

		// --------------------Password
		test = new Button("Test Connection");
		test.addActionListener(this);
		test.setFont(font);
		test.setBounds(50, 220, 200, 35);
		add(test);

		output = new JTextArea();
		output.setFont(font);

		output.setEditable(false);
		JScrollPane scroll = new JScrollPane(output);
		scroll.setBounds(300, 220, 400, 200);
		add(scroll);

		save = new Button("Save");
		save.addActionListener(this);
		save.setFont(font);
		save.setBounds(50, 270, 100, 35);
		save.setEnabled(false);
		add(save);

	}

	@Override
	public void actionPerformed(ActionEvent e) {
		if (e.getSource() == test) {
			if (hostAddress.getText().isEmpty() || port.getText().isEmpty() || userName.getText().isEmpty()
					|| password.getText().isEmpty()) {

				UIManager.put("OptionPane.messageFont", font);
				UIManager.put("OptionPane.buttonFont", font);
				JOptionPane.showMessageDialog(this, "Please Enter All requirments", "Error", JOptionPane.ERROR_MESSAGE);
				return;
			}
			output.setText("Testing... Please Wait");

			connectionObject.setHostAddress(hostAddress.getText());
			connectionObject.setPort(port.getText());
			connectionObject.setUserName(userName.getText());
			connectionObject.setPassword(password.getText());

			String message = "Host Address: " + hostAddress.getText() + "\nPort: " + port.getText() + "\nUser Name: "
					+ userName.getText();
			if (service.testDataBaseConnection(connectionObject)) {
				output.setText(message + "\n\nSucsessfull...");
				save.setEnabled(true);
			} else {
				output.setText(message + "\n\nFail...");
				save.setEnabled(false);
			}
		} else if (e.getSource() == save) {

			String saveResult = service.saveDatabaseConnectionSetting(connectionObject);

			output.setText(
					"Host Address: " + connectionObject.getHostAddress() + "\nPort: " + connectionObject.getPort()
							+ "\nUser Name: " + connectionObject.getUserName() + "\n" + saveResult);

			UIManager.put("OptionPane.messageFont", font);
			UIManager.put("OptionPane.buttonFont", font);
			JOptionPane.showMessageDialog(this, "Please Run the Application again To Connect in the new MySQL Server",
					"Information", JOptionPane.INFORMATION_MESSAGE);
			System.exit(0);
		}

	}

}
