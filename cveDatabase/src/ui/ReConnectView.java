package ui;

import java.awt.Dimension;
import java.awt.Font;
import java.awt.Window;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.SwingUtilities;
import javax.swing.UIManager;

import services.ServiceLayer;

public class ReConnectView extends JPanel implements ActionListener {
	Font font = new Font("Arial", Font.PLAIN, 20);
	ImageIcon loading = new ImageIcon("logo/loader.gif");
	JLabel lbLodingImage = new JLabel("", loading, JLabel.LEFT);
	JButton reconnect = new JButton("Re-Connect");
	JButton setting = new JButton("Setting");
	JLabel reconectText = new JLabel("Connecting...");
	public boolean isConnected = false;

	public ReConnectView() {
		UIManager.put("OptionPane.messageFont", font);
		UIManager.put("OptionPane.buttonFont", font);

		JLabel reloadText = new JLabel(
				"The application lost connection to MySql database. " + "\nPress button to re-connecto to database.");
		reloadText.setSize(new Dimension(450, 250));
		reloadText.setFont(font);
		add(reloadText);

		setPreferredSize(new Dimension(900, 150));
		reconnect.addActionListener(this);
		reconnect.setFont(font);
		setting.setFont(font);
		setting.addActionListener(this);
		add(reconnect);
		reconectText.setFont(font);
		reconectText.setVisible(false);
		add(reconectText);
		lbLodingImage.setVisible(false);
		add(lbLodingImage);

	}

	@Override
	public void actionPerformed(ActionEvent event) {

		if (event.getSource() == reconnect) {
			reconectText.setVisible(true);
			lbLodingImage.setVisible(true);
			Thread th = new Thread(new Runnable() {

				@Override
				public void run() {
					ServiceLayer service = new ServiceLayer();
					isConnected = service.connectToDatabse();
					if (!isConnected) {

						JOptionPane.showMessageDialog(ReConnectView.this,
								"Fail in connect into database \nPlase Go to the File/Setting to modify server addres ",
								"Error", JOptionPane.ERROR_MESSAGE);

					}
					lbLodingImage.setVisible(false);
					reconectText.setVisible(false);
					closeWindoe();

				}
			});

			th.start();

		}
	}

	private void closeWindoe() {
		Window win = SwingUtilities.getWindowAncestor(this);
		if (win != null) {
			win.dispose();
		}

	}

}
